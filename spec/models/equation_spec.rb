require 'rails_helper'
require_relative '../../app/models/equation'

RSpec.describe Equation, type: :model do
  let(:public_key) { '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' }

  describe '.define_authorization' do
    let(:body) { %Q({"type"=>"linear", "a"=>"1", "b"=>"1", "c"=>""}) }
    let(:uri) { '/' }
    let(:computed_signature) { 'li+0H9a4CA2xobvPsiib56wjYTMwxHEepIrKMUOxjW4PlIQnjjGwHThOBJ0cX/3R2C88cU/sJrQD25i26Cs3ug==' }
    let(:auth) { "#{public_key}:#{computed_signature}"}

    it 'read keys from files, compute signature' do
      expect(Equation.define_authorization(body, uri)).to eq(auth)
    end
  end

  describe '.read_public_key', :private do
    it 'read from file' do
      expect(Equation.read_public_key).to eq(public_key)
    end
  end
end
